<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>planc: /Users/rnu/Documents/research/nmflibrary/distntf/distauntf.hpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">planc
   </div>
   <div id="projectbrief">Parallel Lowrank Approximation with Non-negativity Constraints</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_4945428d57d0e875e99234d97a50fad9.html">nmflibrary</a></li><li class="navelem"><a class="el" href="../../dir_47f3b7e4d2cb841b54c17d249a2d4036.html">distntf</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">distauntf.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d2/d6a/distauntf_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Copyright 2016 Ramakrishnan Kannan */</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#ifndef DISTNTF_DISTAUNTF_HPP_</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#define DISTNTF_DISTAUNTF_HPP_</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;armadillo&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/de5/distutils_8hpp.html">common/distutils.hpp</a>&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d2c/ntf__utils_8hpp.html">common/ntf_utils.hpp</a>&quot;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/dca/ddt_8hpp.html">dimtree/ddt.hpp</a>&quot;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d9d/distntfmpicomm_8hpp.html">distntf/distntfmpicomm.hpp</a>&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc8/distntftime_8hpp.html">distntf/distntftime.hpp</a>&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">// #define DISTNTF_VERBOSE 1</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">namespace </span><a class="code" href="../../da/d9d/namespaceplanc.html">planc</a> {</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="../../d2/d6a/distauntf_8hpp.html#a5f5886b6ffbf74dc38dc950d531c5375">   29</a></span>&#160;<span class="preprocessor">#define TENSOR_LOCAL_DIM (m_input_tensor.dimensions())</span></div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="../../d2/d6a/distauntf_8hpp.html#ac57248c9d6f6d4e1a9a891a6db1c00f9">   30</a></span>&#160;<span class="preprocessor">#define TENSOR_LOCAL_NUMEL (m_input_tensor.numel())</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html">   32</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html">DistAUNTF</a> {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; <span class="keyword">protected</span>:</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="comment">// local ncp factors</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html">NCPFactors</a> m_local_ncp_factors;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html">NCPFactors</a> m_local_ncp_factors_t;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="comment">// mttkrp related variables</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> *ncp_mttkrp_t;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> *ncp_local_mttkrp_t;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">// hadamard of the global_grams</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> global_gram;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="comment">// communication related variables</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html">NTFMPICommunicator</a> &amp;m_mpicomm;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="comment">// NLS solve sizes</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <a class="code" href="../../d5/d60/utils_8h.html#af4074c8410f817fe75e7ffa0a2abe69c">UVEC</a> m_nls_sizes;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="../../d5/d60/utils_8h.html#af4074c8410f817fe75e7ffa0a2abe69c">UVEC</a> m_nls_idxs;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keyword">virtual</span> <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> update(<span class="keywordtype">int</span> current_mode) = 0;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d9/d5b/classplanc_1_1_tensor.html">Tensor</a> m_input_tensor;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html">NCPFactors</a> m_gathered_ncp_factors;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html">NCPFactors</a> m_gathered_ncp_factors_t;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">// mttkrp related variables</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> *ncp_krp;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// gram related variables.</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> factor_local_grams;    <span class="comment">// U in the algorithm.</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> *factor_global_grams;  <span class="comment">// G in the algorithm</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="comment">// NTF related variable.</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> m_low_rank_k;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> m_modes;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d5/d60/utils_8h.html#abf52f4e0a107916756992adabfed2712">algotype</a> m_updalgo;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d5/d60/utils_8h.html#af4074c8410f817fe75e7ffa0a2abe69c">UVEC</a> m_global_dims;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d5/d60/utils_8h.html#af4074c8410f817fe75e7ffa0a2abe69c">UVEC</a> m_factor_local_dims;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordtype">int</span> m_num_it;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordtype">int</span> current_mode;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <a class="code" href="../../d5/d60/utils_8h.html#a125109d4fd5ff9434c057b39668145d9">FVEC</a> m_regularizers;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordtype">bool</span> m_compute_error;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordtype">bool</span> m_enable_dim_tree;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordtype">int</span> m_current_it;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordtype">double</span> m_rel_error;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="comment">// needed for acceleration algorithms.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordtype">bool</span> m_accelerated;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  std::vector&lt;bool&gt; m_stale_mttkrp;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">// stats</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html">DistNTFTime</a> time_stats;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="comment">// computing error related;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordtype">double</span> m_global_sqnorm_A;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> hadamard_all_grams;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="../../da/d51/class_dense_dimension_tree.html">DenseDimensionTree</a> *kdt;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordtype">void</span> update_global_gram(<span class="keyword">const</span> <span class="keywordtype">int</span> current_mode) {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">// computing U</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a07b6ae6ec43cf3ac9859dddf771f0652">MPITIC</a>;  <span class="comment">// gram</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">// force a ssyrk instead of gemm.</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> H = m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(current_mode);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    factor_local_grams = H.t() * H;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordtype">double</span> temp = <a class="code" href="../../de/d18/distutils_8h.html#ad30c42027679247ceefdd77ac501a65a">MPITOC</a>;  <span class="comment">// gram</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21b4ea48b952b204ad7ffe0ddd23e8c2">compute_duration</a>(temp);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a90b1672739e29d01a4d9ca63b276ed94">gram_duration</a>(temp);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    factor_global_grams[current_mode].zeros();</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// Computing G.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a07b6ae6ec43cf3ac9859dddf771f0652">MPITIC</a>;  <span class="comment">// allreduce gram</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    MPI_Allreduce(factor_local_grams.memptr(),</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                  factor_global_grams[current_mode].memptr(),</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                  this-&gt;m_low_rank_k * this-&gt;m_low_rank_k, MPI_DOUBLE, MPI_SUM,</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                  MPI_COMM_WORLD);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    temp = <a class="code" href="../../de/d18/distutils_8h.html#ad30c42027679247ceefdd77ac501a65a">MPITOC</a>;  <span class="comment">// allreduce gram</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    applyReg(this-&gt;m_regularizers(current_mode * 2),</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;             this-&gt;m_regularizers(current_mode * 2 + 1),</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;             &amp;(factor_global_grams[current_mode]));</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ad1d4997c821db265583e2849227a4098">communication_duration</a>(temp);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ab29245138b70eba38b4630415f818af4">allreduce_duration</a>(temp);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordtype">void</span> applyReg(<span class="keywordtype">float</span> lambda_l2, <span class="keywordtype">float</span> lambda_l1, <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> *AtA) {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// Frobenius norm regularization</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span> (lambda_l2 &gt; 0) {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> identity = arma::eye&lt;MAT&gt;(this-&gt;m_low_rank_k, this-&gt;m_low_rank_k);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      (*AtA) = (*AtA) + 2 * lambda_l2 * identity;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// L1 - norm regularization</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">if</span> (lambda_l1 &gt; 0) {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> onematrix = arma::ones&lt;MAT&gt;(this-&gt;m_low_rank_k, this-&gt;m_low_rank_k);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      (*AtA) = (*AtA) + 2 * lambda_l1 * onematrix;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordtype">void</span> gram_hadamard(<span class="keywordtype">int</span> current_mode) {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    global_gram.ones();</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a07b6ae6ec43cf3ac9859dddf771f0652">MPITIC</a>;  <span class="comment">// gram hadamard</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_modes; i++) {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordflow">if</span> (i != current_mode) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="comment">//%= element-wise multiplication</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        global_gram %= factor_global_grams[i];</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordtype">double</span> temp = <a class="code" href="../../de/d18/distutils_8h.html#ad30c42027679247ceefdd77ac501a65a">MPITOC</a>;  <span class="comment">// gram hadamard</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21b4ea48b952b204ad7ffe0ddd23e8c2">compute_duration</a>(temp);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a90b1672739e29d01a4d9ca63b276ed94">gram_duration</a>(temp);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// </span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordtype">void</span> gather_ncp_factor(<span class="keyword">const</span> <span class="keywordtype">int</span> current_mode) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    m_gathered_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(current_mode).zeros();</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// Had this comment for debugging memory corruption in all_gather</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// DISTPRINTINFO(&quot;::ncp_krp::&quot; &lt;&lt; ncp_krp[current_mode].memptr()</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">//               &lt;&lt; &quot;::size::&quot; &lt;&lt; ncp_krp[current_mode].n_rows</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">//               &lt;&lt; &quot;x&quot; &lt;&lt; ncp_krp[current_mode].n_cols</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">//               &lt;&lt; &quot;::m_gathered_ncp_factors_t::&quot;</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">//               &lt;&lt; m_gathered_ncp_factors_t.factor(current_mode).memptr()</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">//               &lt;&lt; &quot;::diff from recvcnt::&quot;</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">//               &lt;&lt; m_gathered_ncp_factors_t.factor(current_mode).memptr()</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">//               - recvcnt * 8);</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    MPI_Comm current_slice_comm = this-&gt;m_mpicomm.<a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a823163aefe0200c91ef6c36e08276f47">slice</a>(current_mode);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordtype">int</span> slice_size;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    MPI_Comm_size(current_slice_comm, &amp;slice_size);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">// int sendcnt = m_local_ncp_factors.factor(current_mode).n_elem;</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">int</span> sendcnt = m_nls_sizes[current_mode] * m_low_rank_k;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// int recvcnt = m_local_ncp_factors.factor(current_mode).n_elem;</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    std::vector&lt;int&gt; recvgathercnt(slice_size, 0);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    std::vector&lt;int&gt; recvgatherdispl(slice_size, 0);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">int</span> dimsize = m_factor_local_dims[current_mode];</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; slice_size; i++) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      recvgathercnt[i] = <a class="code" href="../../d9/de5/distutils_8hpp.html#a1381577b342f890deafff510d50c1050">itersplit</a>(dimsize, slice_size, i) * m_low_rank_k;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      recvgatherdispl[i] = <a class="code" href="../../d9/de5/distutils_8hpp.html#ab1187414c9a66ca31f476729c8fe4019">startidx</a>(dimsize, slice_size, i) * m_low_rank_k;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor">#ifdef DISTNTF_VERBOSE</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    MPI_Comm current_fiber_comm = this-&gt;m_mpicomm.<a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a98879091cd81b026c13d15ace1753797">fiber</a>(current_mode);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordtype">int</span> fiber_size;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    MPI_Comm_size(current_fiber_comm, &amp;fiber_size);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    MPI_Comm_size(current_slice_comm, &amp;slice_size);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;::current_mode::&quot;</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                  &lt;&lt; current_mode &lt;&lt; <span class="stringliteral">&quot;::fiber comm size::&quot;</span> &lt;&lt; fiber_size</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;::my_global_rank::&quot;</span> &lt;&lt; <a class="code" href="../../de/d18/distutils_8h.html#a509df87f9aaf440f1c0c42933d21e52a">MPI_RANK</a> &lt;&lt; <span class="stringliteral">&quot;::my_slice_rank::&quot;</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                  &lt;&lt; this-&gt;m_mpicomm.<a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a1b04ea8d23e01aa3cde5c540de574b25">slice_rank</a>(current_mode)</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;::my_fiber_rank::&quot;</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                  &lt;&lt; this-&gt;m_mpicomm.<a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#aa692d8359c7556e68515a055e1609a5a">fiber_rank</a>(current_mode)</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;::sendcnt::&quot;</span> &lt;&lt; sendcnt &lt;&lt; <span class="stringliteral">&quot;::gathered factor size::&quot;</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                  &lt;&lt; m_gathered_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(current_mode).n_elem);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a07b6ae6ec43cf3ac9859dddf771f0652">MPITIC</a>;  <span class="comment">// allgather tic</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    MPI_Allgatherv(m_local_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(current_mode).memptr(), sendcnt,</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                   MPI_DOUBLE,</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                   m_gathered_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(current_mode).memptr(),</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                   &amp;recvgathercnt[0], &amp;recvgatherdispl[0], MPI_DOUBLE,</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                   <span class="comment">// todo:: check whether it is slice or fiber while running</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                   <span class="comment">// and debugging the code.</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                   current_slice_comm);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">// current_slice_comm);</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordtype">double</span> temp = <a class="code" href="../../de/d18/distutils_8h.html#ad30c42027679247ceefdd77ac501a65a">MPITOC</a>;  <span class="comment">// allgather toc</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ad1d4997c821db265583e2849227a4098">communication_duration</a>(temp);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a46afca90f66d7b9e5b4b9f2728aae40a">allgather_duration</a>(temp);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="preprocessor">#ifdef DISTNTF_VERBOSE</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;sent local factor::&quot;</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                  &lt;&lt; std::endl</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                  &lt;&lt; m_local_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(current_mode) &lt;&lt; std::endl</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; gathered factor::&quot;</span> &lt;&lt; std::endl</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                  &lt;&lt; m_gathered_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(current_mode));</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// keep gather_ncp_factors_t consistent.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a07b6ae6ec43cf3ac9859dddf771f0652">MPITIC</a>;  <span class="comment">// transpose tic</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    m_gathered_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#ad817faad2c76a335bc9904187f08394a">set</a>(</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        current_mode, m_gathered_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(current_mode).t());</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    temp = <a class="code" href="../../de/d18/distutils_8h.html#ad30c42027679247ceefdd77ac501a65a">MPITOC</a>;  <span class="comment">// transpose toc</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21b4ea48b952b204ad7ffe0ddd23e8c2">compute_duration</a>(temp);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ac47ee3e921fcc49c1df3e71a210bfbc3">trans_duration</a>(temp);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordtype">void</span> distmttkrp(<span class="keyword">const</span> <span class="keywordtype">int</span> &amp;current_mode) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordtype">double</span> temp;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">if</span> (!this-&gt;m_enable_dim_tree) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <a class="code" href="../../de/d18/distutils_8h.html#a07b6ae6ec43cf3ac9859dddf771f0652">MPITIC</a>;  <span class="comment">// krp tic</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      m_gathered_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#aa9eb7a29cd17b18d8c2526f502da1ecd">krp_leave_out_one</a>(current_mode,</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                                               &amp;ncp_krp[current_mode]);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      temp = <a class="code" href="../../de/d18/distutils_8h.html#ad30c42027679247ceefdd77ac501a65a">MPITOC</a>;  <span class="comment">// krp toc</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21b4ea48b952b204ad7ffe0ddd23e8c2">compute_duration</a>(temp);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a36381a0100f64acc673ad6edde7a9822">krp_duration</a>(temp);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">if</span> (this-&gt;m_enable_dim_tree) {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordtype">double</span> multittv_time = 0;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="keywordtype">double</span> mttkrp_time = 0;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      kdt-&gt;<a class="code" href="../../da/d51/class_dense_dimension_tree.html#a60fbfff326baffbed48aaab575049417">in_order_reuse_MTTKRP</a>(current_mode,</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                                 ncp_mttkrp_t[current_mode].memptr(), <span class="keyword">false</span>,</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                                 multittv_time, mttkrp_time);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21b4ea48b952b204ad7ffe0ddd23e8c2">compute_duration</a>(multittv_time);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21b4ea48b952b204ad7ffe0ddd23e8c2">compute_duration</a>(mttkrp_time);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ab06f56f6cbd7f49d838ce98fae2a5be0">multittv_duration</a>(multittv_time);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21bbb0f1203ee0de54d14d98267b74f4">mttkrp_duration</a>(mttkrp_time);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <a class="code" href="../../de/d18/distutils_8h.html#a07b6ae6ec43cf3ac9859dddf771f0652">MPITIC</a>;  <span class="comment">// mttkrp tic</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      m_input_tensor.<a class="code" href="../../d9/d5b/classplanc_1_1_tensor.html#a1079b99ea562b5d68303eefcffd4d561">mttkrp</a>(current_mode, ncp_krp[current_mode],</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                            &amp;ncp_mttkrp_t[current_mode]);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      temp = <a class="code" href="../../de/d18/distutils_8h.html#ad30c42027679247ceefdd77ac501a65a">MPITOC</a>;  <span class="comment">// mttkrp toc</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21b4ea48b952b204ad7ffe0ddd23e8c2">compute_duration</a>(temp);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21bbb0f1203ee0de54d14d98267b74f4">mttkrp_duration</a>(temp);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">// verify if the dimension tree output matches with the classic one</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">// MAT kdt_ncp_mttkrp_t = ncp_mttkrp_t[current_mode];</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">// bool same_mttkrp = arma::approx_equal(kdt_ncp_mttkrp_t,</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="comment">// ncp_mttkrp_t[current_mode], &quot;absdiff&quot;, 1e-3); PRINTROOT(&quot;kdt vs</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="comment">// mttkrp_t::&quot; &lt;&lt; same_mttkrp); MAT ncp_mttkrp =</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">// ncp_mttkrp_t[current_mode].t(); same_mttkrp =</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// arma::approx_equal(kdt_ncp_mttkrp_t, ncp_mttkrp, &quot;absdiff&quot;, 1e-3);</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// PRINTROOT(&quot;kdt vs mttkrp::&quot; &lt;&lt; same_mttkrp);</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">// PRINTROOT(&quot;kdt mttkrp::&quot; &lt;&lt; kdt_ncp_mttkrp_t);</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// PRINTROOT(&quot;classic mttkrp_t::&quot; &lt;&lt; ncp_mttkrp_t[current_mode]);</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    MPI_Comm current_slice_comm = this-&gt;m_mpicomm.<a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a823163aefe0200c91ef6c36e08276f47">slice</a>(current_mode);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordtype">int</span> slice_size;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordtype">int</span> slice_rank;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    MPI_Comm_size(current_slice_comm, &amp;slice_size);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    slice_rank = this-&gt;m_mpicomm.<a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a1b04ea8d23e01aa3cde5c540de574b25">slice_rank</a>(current_mode);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    std::vector&lt;int&gt; recvmttkrpsize(slice_size);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordtype">int</span> dimsize = m_factor_local_dims[current_mode];</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; slice_size; i++) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      recvmttkrpsize[i] = <a class="code" href="../../d9/de5/distutils_8hpp.html#a1381577b342f890deafff510d50c1050">itersplit</a>(dimsize, slice_size, i) * m_low_rank_k;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor">#ifdef DISTNTF_VERBOSE</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    MPI_Comm current_fiber_comm = this-&gt;m_mpicomm.<a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a98879091cd81b026c13d15ace1753797">fiber</a>(current_mode);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordtype">int</span> fiber_size;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    MPI_Comm_size(current_fiber_comm, &amp;fiber_size);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;::current_mode::&quot;</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                  &lt;&lt; current_mode &lt;&lt; <span class="stringliteral">&quot;::slice comm size::&quot;</span> &lt;&lt; slice_size</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;::fiber comm size::&quot;</span> &lt;&lt; fiber_size</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;::my_global_rank::&quot;</span> &lt;&lt; <a class="code" href="../../de/d18/distutils_8h.html#a509df87f9aaf440f1c0c42933d21e52a">MPI_RANK</a> &lt;&lt; <span class="stringliteral">&quot;::my_slice_rank::&quot;</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                  &lt;&lt; this-&gt;m_mpicomm.<a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a1b04ea8d23e01aa3cde5c540de574b25">slice_rank</a>(current_mode)</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;::my_fiber_rank::&quot;</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                  &lt;&lt; this-&gt;m_mpicomm.<a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#aa692d8359c7556e68515a055e1609a5a">fiber_rank</a>(current_mode)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;::mttkrp_size::&quot;</span> &lt;&lt; ncp_mttkrp_t[current_mode].n_elem</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;::local_mttkrp_size::&quot;</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                  &lt;&lt; ncp_local_mttkrp_t[current_mode].n_elem);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    ncp_local_mttkrp_t[current_mode].zeros();</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a07b6ae6ec43cf3ac9859dddf771f0652">MPITIC</a>;  <span class="comment">// reduce_scatter mttkrp</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    MPI_Reduce_scatter(ncp_mttkrp_t[current_mode].memptr(),</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                       ncp_local_mttkrp_t[current_mode].memptr(),</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                       &amp;recvmttkrpsize[0], MPI_DOUBLE, MPI_SUM,</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                       current_slice_comm);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    temp = <a class="code" href="../../de/d18/distutils_8h.html#ad30c42027679247ceefdd77ac501a65a">MPITOC</a>;  <span class="comment">// reduce_scatter mttkrp</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ad1d4997c821db265583e2849227a4098">communication_duration</a>(temp);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a12315f529ca569f9bbd3d812379816c2">reducescatter_duration</a>(temp);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor">#ifdef DISTNTF_VERBOSE</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(ncp_mttkrp_t[current_mode]);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(ncp_local_mttkrp_t[current_mode]);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    this-&gt;m_stale_mttkrp[current_mode] = <span class="keyword">false</span>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordtype">void</span> allocateMatrices() {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">// allocate matrices.</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">if</span> (!m_enable_dim_tree) {</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      ncp_krp = <span class="keyword">new</span> <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a>[m_modes];</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    }</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    ncp_mttkrp_t = <span class="keyword">new</span> <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a>[m_modes];</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    ncp_local_mttkrp_t = <span class="keyword">new</span> <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a>[m_modes];</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    factor_global_grams = <span class="keyword">new</span> <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a>[m_modes];</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    factor_local_grams.zeros(this-&gt;m_low_rank_k, this-&gt;m_low_rank_k);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    global_gram.ones(this-&gt;m_low_rank_k, this-&gt;m_low_rank_k);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <a class="code" href="../../d5/d60/utils_8h.html#a0428171499a4ab7aebc2bf058ae337df">UWORD</a> current_size = 0;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_modes; i++) {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      current_size = <a class="code" href="../../d2/d6a/distauntf_8hpp.html#ac57248c9d6f6d4e1a9a891a6db1c00f9">TENSOR_LOCAL_NUMEL</a> / <a class="code" href="../../d2/d6a/distauntf_8hpp.html#a5f5886b6ffbf74dc38dc950d531c5375">TENSOR_LOCAL_DIM</a>[i];</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keywordflow">if</span> (!m_enable_dim_tree) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        ncp_krp[i] = arma::zeros(current_size, this-&gt;m_low_rank_k);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      ncp_mttkrp_t[i] = arma::zeros(this-&gt;m_low_rank_k, <a class="code" href="../../d2/d6a/distauntf_8hpp.html#a5f5886b6ffbf74dc38dc950d531c5375">TENSOR_LOCAL_DIM</a>[i]);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      ncp_local_mttkrp_t[i] = arma::zeros(m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(i).n_cols,</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                                          m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(i).n_rows);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      factor_global_grams[i] =</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;          arma::zeros(this-&gt;m_low_rank_k, this-&gt;m_low_rank_k);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordtype">void</span> freeMatrices() {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_modes; i++) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keywordflow">if</span> (!m_enable_dim_tree) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        ncp_krp[i].clear();</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      ncp_mttkrp_t[i].clear();</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      ncp_local_mttkrp_t[i].clear();</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      factor_global_grams[i].clear();</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">if</span> (!m_enable_dim_tree) {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keyword">delete</span>[] ncp_krp;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keyword">delete</span>[] ncp_mttkrp_t;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keyword">delete</span>[] ncp_local_mttkrp_t;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keyword">delete</span>[] factor_global_grams;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordtype">void</span> reportTime(<span class="keyword">const</span> <span class="keywordtype">double</span> temp, <span class="keyword">const</span> std::string &amp;reportstring) {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordtype">double</span> mintemp, maxtemp, sumtemp;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    MPI_Allreduce(&amp;temp, &amp;maxtemp, 1, MPI_DOUBLE, MPI_MAX, MPI_COMM_WORLD);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    MPI_Allreduce(&amp;temp, &amp;mintemp, 1, MPI_DOUBLE, MPI_MIN, MPI_COMM_WORLD);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    MPI_Allreduce(&amp;temp, &amp;sumtemp, 1, MPI_DOUBLE, MPI_SUM, MPI_COMM_WORLD);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#ac0fb59b02f5b7697ffdc417c8d7d16ea">PRINTROOT</a>(reportstring  <span class="comment">// &lt;&lt; &quot;::dims::&quot; &lt;&lt; this-&gt;m_global_dims.t()</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;::k::&quot;</span> &lt;&lt; this-&gt;m_low_rank_k &lt;&lt; <span class="stringliteral">&quot;::SIZE::&quot;</span> &lt;&lt; <a class="code" href="../../de/d18/distutils_8h.html#a854b965f7a7fa796d55b57d4b50d47df">MPI_SIZE</a></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;::algo::&quot;</span> &lt;&lt; this-&gt;m_updalgo &lt;&lt; <span class="stringliteral">&quot;::root::&quot;</span> &lt;&lt; temp</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;::min::&quot;</span> &lt;&lt; mintemp &lt;&lt; <span class="stringliteral">&quot;::avg::&quot;</span> &lt;&lt; (sumtemp) / (<a class="code" href="../../de/d18/distutils_8h.html#a854b965f7a7fa796d55b57d4b50d47df">MPI_SIZE</a>)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;::max::&quot;</span> &lt;&lt; maxtemp);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  }</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordtype">void</span> update_factor_mode(<span class="keyword">const</span> <span class="keywordtype">int</span> current_mode, <span class="keyword">const</span> <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> &amp;<a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a5e8e08d197922ae08b7278c0638a54b8">factor</a>) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#ad817faad2c76a335bc9904187f08394a">set</a>(current_mode, <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a5e8e08d197922ae08b7278c0638a54b8">factor</a>);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    m_local_ncp_factors.distributed_normalize(current_mode);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> factor_t = m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(current_mode).t();</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    m_local_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#ad817faad2c76a335bc9904187f08394a">set</a>(current_mode, factor_t);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    m_local_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a78134126a1dfc0f8f9f39d96f4fd100d">set_lambda</a>(m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a9359f1890a4ffa2e7caeecf9667cffe1">lambda</a>());</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="comment">// line 13 and 14</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    update_global_gram(current_mode);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="comment">// line 15</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    gather_ncp_factor(current_mode);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">if</span> (this-&gt;m_enable_dim_tree) {</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      kdt-&gt;<a class="code" href="../../da/d51/class_dense_dimension_tree.html#aa8a9d63ae220a52ae0744995b2e3f463">set_factor</a>(m_gathered_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(current_mode).memptr(),</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                      current_mode);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    }</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> mode = 0; mode &lt; this-&gt;m_modes; mode++) {</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordflow">if</span> (mode != current_mode) this-&gt;m_stale_mttkrp[mode] = <span class="keyword">true</span>;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  } </div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> accelerate() {}</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordtype">void</span> generateReport() {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    MPI_Barrier(MPI_COMM_WORLD);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a3cea39b5d73cc44fc9935c9d66800ee4">duration</a>(), <span class="stringliteral">&quot;total_d&quot;</span>);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ad1d4997c821db265583e2849227a4098">communication_duration</a>(), <span class="stringliteral">&quot;total_comm&quot;</span>);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21b4ea48b952b204ad7ffe0ddd23e8c2">compute_duration</a>(), <span class="stringliteral">&quot;total_comp&quot;</span>);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a46afca90f66d7b9e5b4b9f2728aae40a">allgather_duration</a>(), <span class="stringliteral">&quot;total_allgather&quot;</span>);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ab29245138b70eba38b4630415f818af4">allreduce_duration</a>(), <span class="stringliteral">&quot;total_allreduce&quot;</span>);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a12315f529ca569f9bbd3d812379816c2">reducescatter_duration</a>(),</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                     <span class="stringliteral">&quot;total_reducescatter&quot;</span>);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a90b1672739e29d01a4d9ca63b276ed94">gram_duration</a>(), <span class="stringliteral">&quot;total_gram&quot;</span>);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a36381a0100f64acc673ad6edde7a9822">krp_duration</a>(), <span class="stringliteral">&quot;total_krp&quot;</span>);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21bbb0f1203ee0de54d14d98267b74f4">mttkrp_duration</a>(), <span class="stringliteral">&quot;total_mttkrp&quot;</span>);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ab06f56f6cbd7f49d838ce98fae2a5be0">multittv_duration</a>(), <span class="stringliteral">&quot;total_multittv&quot;</span>);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#aae089d72ce9a234054c9b760324c2e74">nnls_duration</a>(), <span class="stringliteral">&quot;total_nnls&quot;</span>);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">if</span> (this-&gt;m_compute_error) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a6115b102335dae49c1f025a869194981">err_compute_duration</a>(),</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                       <span class="stringliteral">&quot;total_err_compute&quot;</span>);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      this-&gt;reportTime(this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a6115b102335dae49c1f025a869194981">err_compute_duration</a>(),</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                       <span class="stringliteral">&quot;total_err_communication&quot;</span>);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    }</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  }</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00432"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a664ac0ec775a16781965ed66473e8c7b">  432</a></span>&#160;  <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a664ac0ec775a16781965ed66473e8c7b">DistAUNTF</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d5b/classplanc_1_1_tensor.html">Tensor</a> &amp;i_tensor, <span class="keyword">const</span> <span class="keywordtype">int</span> i_k, <a class="code" href="../../d5/d60/utils_8h.html#abf52f4e0a107916756992adabfed2712">algotype</a> i_algo,</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d5/d60/utils_8h.html#af4074c8410f817fe75e7ffa0a2abe69c">UVEC</a> &amp;i_global_dims, <span class="keyword">const</span> <a class="code" href="../../d5/d60/utils_8h.html#af4074c8410f817fe75e7ffa0a2abe69c">UVEC</a> &amp;i_local_dims,</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d5/d60/utils_8h.html#af4074c8410f817fe75e7ffa0a2abe69c">UVEC</a> &amp;i_nls_sizes, <span class="keyword">const</span> <a class="code" href="../../d5/d60/utils_8h.html#af4074c8410f817fe75e7ffa0a2abe69c">UVEC</a> &amp;i_nls_idxs,</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html">NTFMPICommunicator</a> &amp;i_mpicomm)</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      : m_input_tensor(i_tensor.dimensions(), i_tensor.m_data),</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        m_low_rank_k(i_k),</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        m_updalgo(i_algo),</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        m_mpicomm(i_mpicomm),</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        m_modes(m_input_tensor.<a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a0a93f315ef938644f636995bda8edd65">modes</a>()),</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        m_global_dims(i_global_dims),</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        m_factor_local_dims(i_local_dims),</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        m_nls_sizes(i_nls_sizes),</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        m_nls_idxs(i_nls_idxs),</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        m_local_ncp_factors(i_nls_sizes, i_k, false),</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        m_local_ncp_factors_t(i_nls_sizes, i_k, true),</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        m_gathered_ncp_factors(i_tensor.dimensions(), i_k, false),</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        m_gathered_ncp_factors_t(i_tensor.dimensions(), i_k, true),</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        time_stats(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    this-&gt;m_compute_error = <span class="keyword">false</span>;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    this-&gt;m_enable_dim_tree = <span class="keyword">false</span>;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    this-&gt;m_accelerated = <span class="keyword">false</span>;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    this-&gt;m_num_it = 30;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    this-&gt;m_rel_error = 1.0;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// randomize again. otherwise all the process and factors</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">// will be same.</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a079e4cff86225cab685586d40c6ef8e8">randu</a>(149 * i_mpicomm.<a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a2ad9058522acfaaa1a8fbe40348fea0d">rank</a>() + 103);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    m_local_ncp_factors.distributed_normalize();</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; this-&gt;m_modes; i++) {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> current_factor = arma::trans(m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(i));</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      m_local_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#ad817faad2c76a335bc9904187f08394a">set</a>(i, current_factor);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      this-&gt;m_stale_mttkrp.push_back(<span class="keyword">true</span>);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    m_local_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a78134126a1dfc0f8f9f39d96f4fd100d">set_lambda</a>(m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a9359f1890a4ffa2e7caeecf9667cffe1">lambda</a>());</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    m_gathered_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#aff5902bc2267a2a5abaa6cac04cc9d8d">trans</a>(m_gathered_ncp_factors_t);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    allocateMatrices();</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordtype">double</span> normA = i_tensor.<a class="code" href="../../d9/d5b/classplanc_1_1_tensor.html#a3af9a550ddb640cc12edf60c57d10db7">norm</a>();</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    MPI_Allreduce(&amp;normA, &amp;this-&gt;m_global_sqnorm_A, 1, MPI_DOUBLE, MPI_SUM,</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                  MPI_COMM_WORLD);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;::NLS Solve Sizes::&quot;</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                  &lt;&lt; m_nls_sizes &lt;&lt; <span class="stringliteral">&quot;::NLS start indices::&quot;</span> &lt;&lt; m_nls_idxs);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  }</div><div class="line"><a name="l00474"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ad1a374db565c4b6af36029b8516fe305">  474</a></span>&#160;  <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ad1a374db565c4b6af36029b8516fe305">~DistAUNTF</a>() {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    freeMatrices();</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span> (this-&gt;m_enable_dim_tree) {</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="keyword">delete</span> kdt;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    }</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  }</div><div class="line"><a name="l00481"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ae3ffb151ee3735ae23092e456ac0a15a">  481</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ae3ffb151ee3735ae23092e456ac0a15a">num_iterations</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> i_n) { this-&gt;m_num_it = i_n; }</div><div class="line"><a name="l00483"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a0a93f315ef938644f636995bda8edd65">  483</a></span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a0a93f315ef938644f636995bda8edd65">modes</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> this-&gt;m_modes; }</div><div class="line"><a name="l00485"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a13e65e6310d7c6b3c2198054c3e6578e">  485</a></span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a13e65e6310d7c6b3c2198054c3e6578e">rank</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> this-&gt;m_low_rank_k; }</div><div class="line"><a name="l00487"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ae7d14dd72b08811d9db6b6085a63976e">  487</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ae7d14dd72b08811d9db6b6085a63976e">regularizers</a>(<span class="keyword">const</span> <a class="code" href="../../d5/d60/utils_8h.html#a125109d4fd5ff9434c057b39668145d9">FVEC</a> i_regs) { this-&gt;m_regularizers = i_regs; }</div><div class="line"><a name="l00489"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a774d8786d47ebc8af750bbf283914f7e">  489</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a774d8786d47ebc8af750bbf283914f7e">compute_error</a>(<span class="keywordtype">bool</span> i_error) {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    this-&gt;m_compute_error = i_error;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    hadamard_all_grams =</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        arma::ones&lt;MAT&gt;(this-&gt;m_low_rank_k, this-&gt;m_low_rank_k);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  }</div><div class="line"><a name="l00495"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a7088f10e6f50e34897e1cbab37d85d0a">  495</a></span>&#160;  <a class="code" href="../../d5/d60/utils_8h.html#a4749c5f07d5b90ecf9f3d53002f45b0b">VEC</a> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a7088f10e6f50e34897e1cbab37d85d0a">lambda</a>() { <span class="keywordflow">return</span> m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a9359f1890a4ffa2e7caeecf9667cffe1">lambda</a>(); }</div><div class="line"><a name="l00497"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a4484bf5705eae381d5f5a2d549c5f073">  497</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a4484bf5705eae381d5f5a2d549c5f073">current_it</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> this-&gt;m_current_it; }</div><div class="line"><a name="l00499"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#acc07c4b57bc37fa734ef2b5206a2d3b9">  499</a></span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#acc07c4b57bc37fa734ef2b5206a2d3b9">current_error</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> this-&gt;m_rel_error; }</div><div class="line"><a name="l00501"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#aaff9d99376f4e0e1ae1be2de571dd415">  501</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#aaff9d99376f4e0e1ae1be2de571dd415">dim_tree</a>(<span class="keywordtype">bool</span> i_dim_tree) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    this-&gt;m_enable_dim_tree = i_dim_tree;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">if</span> (this-&gt;m_enable_dim_tree) {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="keywordflow">if</span> (this-&gt;ncp_krp != NULL) {</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_modes; i++) {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;          ncp_krp[i].clear();</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keyword">delete</span>[] ncp_krp;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      }</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    }</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  }</div><div class="line"><a name="l00513"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a4fbe531ee6eb6167f8f2aa235851ecb0">  513</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a4fbe531ee6eb6167f8f2aa235851ecb0">accelerated</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;set_acceleration) {</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    this-&gt;m_accelerated = set_acceleration;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    this-&gt;m_compute_error = <span class="keyword">true</span>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  }</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ac3fb680837e8f5ff49a0fb6294b75d85">  518</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ac3fb680837e8f5ff49a0fb6294b75d85">is_stale_mttkrp</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> &amp;current_mode)<span class="keyword"> const </span>{</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keywordflow">return</span> this-&gt;m_stale_mttkrp[current_mode];</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  }</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#af9e34f20ee83b11dd197606069ea9438">  529</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#af9e34f20ee83b11dd197606069ea9438">reset</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html">NCPFactors</a> &amp;new_factors, <span class="keywordtype">bool</span> trans = <span class="keyword">false</span>) {</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">if</span> (!trans) {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_modes; i++) {</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        update_factor_mode(i, new_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(i));</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_modes; i++) {</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        update_factor_mode(i, new_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(i).t());</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      }</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a78134126a1dfc0f8f9f39d96f4fd100d">set_lambda</a>(new_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a9359f1890a4ffa2e7caeecf9667cffe1">lambda</a>());</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    m_local_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a78134126a1dfc0f8f9f39d96f4fd100d">set_lambda</a>(new_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a9359f1890a4ffa2e7caeecf9667cffe1">lambda</a>());</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="comment">// Preferrably call this after the computeNTF().</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="comment">// This is right now called to save the factor matrices.</span></div><div class="line"><a name="l00552"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a5e8e08d197922ae08b7278c0638a54b8">  552</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a5e8e08d197922ae08b7278c0638a54b8">factor</a>(<span class="keywordtype">int</span> mode, <span class="keywordtype">double</span> *factor_matrix) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    gather_ncp_factor(mode);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordtype">int</span> sendcnt = m_gathered_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(mode).n_elem;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordtype">int</span> fiber_size = this-&gt;m_mpicomm.<a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a0510fe0fc47a3d3a2ae0a6a8733e42c4">proc_grids</a>()[mode];</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordtype">int</span> global_size = this-&gt;m_global_dims[mode];</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    std::vector&lt;int&gt; recvcnts(fiber_size, 0);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    std::vector&lt;int&gt; displs(fiber_size, 0);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">// int dimsize = m_factor_local_dims[current_mode];</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; fiber_size; i++) {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      recvcnts[i] = <a class="code" href="../../d9/de5/distutils_8hpp.html#a1381577b342f890deafff510d50c1050">itersplit</a>(global_size, fiber_size, i) * m_low_rank_k;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      displs[i] = <a class="code" href="../../d9/de5/distutils_8hpp.html#ab1187414c9a66ca31f476729c8fe4019">startidx</a>(global_size, fiber_size, i) * m_low_rank_k;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    }</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    MPI_Gatherv(m_gathered_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(mode).memptr(), sendcnt,</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                MPI_DOUBLE, factor_matrix, &amp;recvcnts[0], &amp;displs[0], MPI_DOUBLE,</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                <span class="comment">// todo:: check whether it is slice or fiber while running</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                <span class="comment">// and debugging the code.</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                0, this-&gt;m_mpicomm.<a class="code" href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a98879091cd81b026c13d15ace1753797">fiber</a>(mode));</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  }</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno"><a class="line" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a3882110157f46bacf3546aa9f715e008">  574</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a3882110157f46bacf3546aa9f715e008">computeNTF</a>() {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">// initialize everything.</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">// line 3,4,5 of the algorithm</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; m_modes; i++) {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      update_global_gram(i);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      gather_ncp_factor(i);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span> (this-&gt;m_enable_dim_tree) {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="comment">// Determine optimial split when given mode ordering.</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <span class="comment">// product of left dimensions \approx product of right dimensions.</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="keywordtype">size_t</span> split_criteria = arma::prod(m_input_tensor.<a class="code" href="../../d9/d5b/classplanc_1_1_tensor.html#a9eadbed3e2a4cb987d5a3c91f7c14122">dimensions</a>());</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      split_criteria = std::round(std::sqrt(split_criteria));</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#af4074c8410f817fe75e7ffa0a2abe69c">UVEC</a> temp_cum_prod = arma::cumprod(m_input_tensor.<a class="code" href="../../d9/d5b/classplanc_1_1_tensor.html#a9eadbed3e2a4cb987d5a3c91f7c14122">dimensions</a>());</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <span class="keywordtype">int</span> split_mode = 0;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="keywordflow">while</span> (temp_cum_prod(split_mode) &lt; split_criteria) {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        split_mode++;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="comment">// check to see if split mode is left or right.</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="keywordtype">size_t</span> current_left = temp_cum_prod(split_mode);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keywordtype">size_t</span> good_criteria = temp_cum_prod(temp_cum_prod.n_rows - 1) /</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                             temp_cum_prod(split_mode - 1);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      <span class="keywordflow">if</span> (current_left &gt; good_criteria) split_mode--;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <a class="code" href="../../de/d18/distutils_8h.html#ac0fb59b02f5b7697ffdc417c8d7d16ea">PRINTROOT</a>(<span class="stringliteral">&quot;KDT Split Mode::&quot;</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                &lt;&lt; split_mode &lt;&lt; <span class="stringliteral">&quot;::split criteria::&quot;</span> &lt;&lt; split_criteria</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;::numerator::&quot;</span> &lt;&lt; temp_cum_prod(temp_cum_prod.n_rows - 1)</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;::good_criteria::&quot;</span> &lt;&lt; good_criteria</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;::current_left::&quot;</span> &lt;&lt; current_left &lt;&lt; std::endl</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;::cum prod::&quot;</span> &lt;&lt; std::endl</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                &lt;&lt; temp_cum_prod &lt;&lt; std::endl);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      kdt = <span class="keyword">new</span> <a class="code" href="../../da/d51/class_dense_dimension_tree.html">DenseDimensionTree</a>(m_input_tensor, m_gathered_ncp_factors,</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                                   split_mode);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="preprocessor">#ifdef DISTNTF_VERBOSE</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;local factor matrices::&quot;</span>);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    this-&gt;m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a4e062f586865ea4d312a8b8e523c9dd2">print</a>();</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;local factor matrices transpose::&quot;</span>);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    this-&gt;m_local_ncp_factors_t.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a4e062f586865ea4d312a8b8e523c9dd2">print</a>();</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;gathered factor matrices::&quot;</span>);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    this-&gt;m_gathered_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a4e062f586865ea4d312a8b8e523c9dd2">print</a>();</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">for</span> (this-&gt;m_current_it = 0; this-&gt;m_current_it &lt; m_num_it;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;         this-&gt;m_current_it++) {</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> unnorm_factor;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> current_mode = 0; current_mode &lt; m_modes; current_mode++) {</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="comment">// line 9 and 10 of the algorithm</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ac3fb680837e8f5ff49a0fb6294b75d85">is_stale_mttkrp</a>(current_mode)) distmttkrp(current_mode);</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="comment">// line 11 of the algorithm</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        gram_hadamard(current_mode);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="comment">// line 12 of the algorithm</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="preprocessor">#ifdef DISTNTF_VERBOSE</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;local factor matrix::&quot;</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                      &lt;&lt; this-&gt;m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">factor</a>(current_mode));</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;gathered factor matrix::&quot;</span>);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        this-&gt;m_gathered_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a4e062f586865ea4d312a8b8e523c9dd2">print</a>();</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <a class="code" href="../../de/d18/distutils_8h.html#ac0fb59b02f5b7697ffdc417c8d7d16ea">PRINTROOT</a>(<span class="stringliteral">&quot;global_grams::&quot;</span> &lt;&lt; std::endl &lt;&lt; this-&gt;global_gram);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;mttkrp::&quot;</span>);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        this-&gt;ncp_local_mttkrp_t[current_mode].print();</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <a class="code" href="../../de/d18/distutils_8h.html#a07b6ae6ec43cf3ac9859dddf771f0652">MPITIC</a>;  <span class="comment">// nnls_tic</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a5e8e08d197922ae08b7278c0638a54b8">factor</a> = update(current_mode);</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordtype">double</span> temp = <a class="code" href="../../de/d18/distutils_8h.html#ad30c42027679247ceefdd77ac501a65a">MPITOC</a>;  <span class="comment">// nnls_toc</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21b4ea48b952b204ad7ffe0ddd23e8c2">compute_duration</a>(temp);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#aae089d72ce9a234054c9b760324c2e74">nnls_duration</a>(temp);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="preprocessor">#ifdef DISTNTF_VERBOSE</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;it::&quot;</span> &lt;&lt; this-&gt;m_current_it &lt;&lt; <span class="stringliteral">&quot;::mode::&quot;</span> &lt;&lt; current_mode</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                             &lt;&lt; std::endl</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                             &lt;&lt; <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a5e8e08d197922ae08b7278c0638a54b8">factor</a>);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="keywordflow">if</span> (m_compute_error &amp;&amp; current_mode == this-&gt;m_modes - 1) {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          unnorm_factor = <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a5e8e08d197922ae08b7278c0638a54b8">factor</a>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        update_factor_mode(current_mode, <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a5e8e08d197922ae08b7278c0638a54b8">factor</a>.t());</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      }</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="keywordflow">if</span> (m_compute_error) {</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="keywordtype">double</span> temp_err = computeError(unnorm_factor, this-&gt;m_modes - 1);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        this-&gt;m_rel_error = temp_err;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keywordtype">double</span> iter_time = this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21b4ea48b952b204ad7ffe0ddd23e8c2">compute_duration</a>() +</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                           this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ad1d4997c821db265583e2849227a4098">communication_duration</a>();</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <a class="code" href="../../de/d18/distutils_8h.html#ac0fb59b02f5b7697ffdc417c8d7d16ea">PRINTROOT</a>(<span class="stringliteral">&quot;Iter::&quot;</span> &lt;&lt; this-&gt;m_current_it &lt;&lt; <span class="stringliteral">&quot;::k::&quot;</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                           &lt;&lt; this-&gt;m_low_rank_k &lt;&lt; <span class="stringliteral">&quot;::SIZE::&quot;</span> &lt;&lt; <a class="code" href="../../de/d18/distutils_8h.html#a854b965f7a7fa796d55b57d4b50d47df">MPI_SIZE</a></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                           &lt;&lt; <span class="stringliteral">&quot;::algo::&quot;</span> &lt;&lt; this-&gt;m_updalgo &lt;&lt; <span class="stringliteral">&quot;::time::&quot;</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                           &lt;&lt; iter_time &lt;&lt; <span class="stringliteral">&quot;::relative_error::&quot;</span> &lt;&lt; temp_err);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      }</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="keywordflow">if</span> (this-&gt;m_accelerated) {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="comment">// there is a acceleration possible. call accelerate method</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="comment">// in the derived class.</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        accelerate();</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <a class="code" href="../../de/d18/distutils_8h.html#ac0fb59b02f5b7697ffdc417c8d7d16ea">PRINTROOT</a>(<span class="stringliteral">&quot;completed it::&quot;</span> &lt;&lt; this-&gt;m_current_it);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    }</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    generateReport();</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="keywordtype">double</span> computeError(<span class="keyword">const</span> <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> &amp;unnorm_factor, <span class="keywordtype">int</span> mode) {</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="comment">// rel_Error = sqrt(max(init.nr_X^2 + lambda^T * Hadamard of all gram *</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="comment">// lambda - 2 * innerprod(X,F_kten),0))/init.nr_X;</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a07b6ae6ec43cf3ac9859dddf771f0652">MPITIC</a>;  <span class="comment">// err compute</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    hadamard_all_grams = global_gram % factor_global_grams[mode];</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <a class="code" href="../../d5/d60/utils_8h.html#a4749c5f07d5b90ecf9f3d53002f45b0b">VEC</a> local_lambda = m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a9359f1890a4ffa2e7caeecf9667cffe1">lambda</a>();</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <a class="code" href="../../d5/d60/utils_8h.html#a65b44e666e1dbe8bd854bde3e58b1a5d">ROWVEC</a> temp_vec = local_lambda.t() * hadamard_all_grams;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordtype">double</span> sq_norm_model = arma::dot(temp_vec, local_lambda);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="comment">// double sq_norm_model = arma::norm(hadamard_all_grams, &quot;fro&quot;);</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">// sum of the element-wise dot product between the local mttkrp and</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="comment">// the factor matrix</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordtype">double</span> inner_product = arma::dot(ncp_local_mttkrp_t[mode], unnorm_factor);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordtype">double</span> temp = <a class="code" href="../../de/d18/distutils_8h.html#ad30c42027679247ceefdd77ac501a65a">MPITOC</a>;  <span class="comment">// err compute</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21b4ea48b952b204ad7ffe0ddd23e8c2">compute_duration</a>(temp);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a6115b102335dae49c1f025a869194981">err_compute_duration</a>(temp);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordtype">double</span> all_inner_product;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a07b6ae6ec43cf3ac9859dddf771f0652">MPITIC</a>;  <span class="comment">// err comm</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    MPI_Allreduce(&amp;inner_product, &amp;all_inner_product, 1, MPI_DOUBLE, MPI_SUM,</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                  MPI_COMM_WORLD);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    temp = <a class="code" href="../../de/d18/distutils_8h.html#ad30c42027679247ceefdd77ac501a65a">MPITOC</a>;  <span class="comment">// err comm</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ad1d4997c821db265583e2849227a4098">communication_duration</a>(temp);</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    this-&gt;time_stats.<a class="code" href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ae10f032b3c378bc6b6c4b0b49fb54dbb">err_communication_duration</a>(temp);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="preprocessor">#ifdef DISTNTF_VERBOSE</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;local_lambda::&quot;</span> &lt;&lt; local_lambda);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a>(<span class="stringliteral">&quot;local_inner_product::&quot;</span> &lt;&lt; inner_product &lt;&lt; std::endl);</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <a class="code" href="../../de/d18/distutils_8h.html#ac0fb59b02f5b7697ffdc417c8d7d16ea">PRINTROOT</a>(<span class="stringliteral">&quot;norm_A_sq :: &quot;</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;              &lt;&lt; this-&gt;m_global_sqnorm_A &lt;&lt; <span class="stringliteral">&quot;::model_norm_sq::&quot;</span> &lt;&lt; sq_norm_model</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;::global_inner_product::&quot;</span> &lt;&lt; all_inner_product &lt;&lt; std::endl);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordtype">double</span> squared_err =</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        this-&gt;m_global_sqnorm_A + sq_norm_model - 2 * all_inner_product;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">if</span> (squared_err &lt; 0) {</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <a class="code" href="../../de/d18/distutils_8h.html#ac0fb59b02f5b7697ffdc417c8d7d16ea">PRINTROOT</a>(<span class="stringliteral">&quot;computed error is negative due to round off&quot;</span>);</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <a class="code" href="../../de/d18/distutils_8h.html#ac0fb59b02f5b7697ffdc417c8d7d16ea">PRINTROOT</a>(<span class="stringliteral">&quot;norm_A_sq :: &quot;</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                &lt;&lt; this-&gt;m_global_sqnorm_A</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;::model_norm_sq::&quot;</span> &lt;&lt; sq_norm_model</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;::global_inner_product::&quot;</span> &lt;&lt; all_inner_product</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;::squared_err::&quot;</span> &lt;&lt; squared_err &lt;&lt; std::endl);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    }</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">return</span> std::sqrt(std::abs(squared_err) / this-&gt;m_global_sqnorm_A);</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  }</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="keywordtype">double</span> computeError(<span class="keyword">const</span> NCPFactors &amp;new_factors_t, <span class="keyword">const</span> <span class="keywordtype">int</span> mode) {</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="comment">// rel_Error = sqrt(max(init.nr_X^2 + lambda^T * Hadamard of all gram *</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="comment">// lambda - 2 * innerprod(X,F_kten),0))/init.nr_X;</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="comment">// Reset with new factors and compute error on mode 0</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <a class="code" href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#af9e34f20ee83b11dd197606069ea9438">reset</a>(new_factors_t, <span class="keyword">true</span>);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    distmttkrp(mode);</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    gram_hadamard(mode);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    hadamard_all_grams = global_gram % factor_global_grams[mode];</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <a class="code" href="../../d5/d60/utils_8h.html#a4749c5f07d5b90ecf9f3d53002f45b0b">VEC</a> local_lambda = m_local_ncp_factors.<a class="code" href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a9359f1890a4ffa2e7caeecf9667cffe1">lambda</a>();</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <a class="code" href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a> unnorm_factor =</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        arma::diagmat(local_lambda) * new_factors_t.factor(mode);</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <a class="code" href="../../d5/d60/utils_8h.html#a65b44e666e1dbe8bd854bde3e58b1a5d">ROWVEC</a> temp_vec = local_lambda.t() * hadamard_all_grams;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordtype">double</span> sq_norm_model = arma::dot(temp_vec, local_lambda);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="comment">// double sq_norm_model = arma::norm(hadamard_all_grams, &quot;fro&quot;);</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="comment">// sum of the element-wise dot product between the local mttkrp and</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">// the factor matrix</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keywordtype">double</span> inner_product = arma::dot(ncp_local_mttkrp_t[mode], unnorm_factor);</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordtype">double</span> all_inner_product;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    MPI_Allreduce(&amp;inner_product, &amp;all_inner_product, 1, MPI_DOUBLE, MPI_SUM,</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                  MPI_COMM_WORLD);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordtype">double</span> squared_err =</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        this-&gt;m_global_sqnorm_A + sq_norm_model - 2 * all_inner_product;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">if</span> (squared_err &lt; 0) {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <a class="code" href="../../de/d18/distutils_8h.html#ac0fb59b02f5b7697ffdc417c8d7d16ea">PRINTROOT</a>(<span class="stringliteral">&quot;computed error is negative due to round off&quot;</span>);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <a class="code" href="../../de/d18/distutils_8h.html#ac0fb59b02f5b7697ffdc417c8d7d16ea">PRINTROOT</a>(<span class="stringliteral">&quot;norm_A_sq :: &quot;</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                &lt;&lt; this-&gt;m_global_sqnorm_A</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;::model_norm_sq::&quot;</span> &lt;&lt; sq_norm_model</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;::global_inner_product::&quot;</span> &lt;&lt; all_inner_product</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;::squared_err::&quot;</span> &lt;&lt; squared_err &lt;&lt; std::endl);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    }</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordflow">return</span> std::sqrt(std::abs(squared_err) / this-&gt;m_global_sqnorm_A);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;};  <span class="comment">// class DistAUNTF</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;}  <span class="comment">// namespace planc</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="preprocessor">#endif  // DISTNTF_DISTAUNTF_HPP_</span></div><div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_a13e65e6310d7c6b3c2198054c3e6578e"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a13e65e6310d7c6b3c2198054c3e6578e">planc::DistAUNTF::rank</a></div><div class="ttdeci">size_t rank() const</div><div class="ttdoc">Low Rank. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00485">distauntf.hpp:485</a></div></div>
<div class="ttc" id="classplanc_1_1_n_c_p_factors_html_aa9eb7a29cd17b18d8c2526f502da1ecd"><div class="ttname"><a href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#aa9eb7a29cd17b18d8c2526f502da1ecd">planc::NCPFactors::krp_leave_out_one</a></div><div class="ttdeci">MAT krp_leave_out_one(const int i_n)</div><div class="ttdoc">KRP leaving out the mode i_n. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d12/ncpfactors_8hpp_source.html#l00157">ncpfactors.hpp:157</a></div></div>
<div class="ttc" id="classplanc_1_1_n_c_p_factors_html_a079e4cff86225cab685586d40c6ef8e8"><div class="ttname"><a href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a079e4cff86225cab685586d40c6ef8e8">planc::NCPFactors::randu</a></div><div class="ttdeci">void randu(const int i_seed)</div><div class="ttdoc">initializes the local tensor with the given seed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d12/ncpfactors_8hpp_source.html#l00376">ncpfactors.hpp:376</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_ae10f032b3c378bc6b6c4b0b49fb54dbb"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ae10f032b3c378bc6b6c4b0b49fb54dbb">planc::DistNTFTime::err_communication_duration</a></div><div class="ttdeci">const double err_communication_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00091">distntftime.hpp:91</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_a4fbe531ee6eb6167f8f2aa235851ecb0"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a4fbe531ee6eb6167f8f2aa235851ecb0">planc::DistAUNTF::accelerated</a></div><div class="ttdeci">void accelerated(const bool &amp;set_acceleration)</div><div class="ttdoc">Does the algorithm need acceleration? </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00513">distauntf.hpp:513</a></div></div>
<div class="ttc" id="classplanc_1_1_tensor_html"><div class="ttname"><a href="../../d9/d5b/classplanc_1_1_tensor.html">planc::Tensor</a></div><div class="ttdoc">Data is stored such that the unfolding  is column major. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8b/tensor_8hpp_source.html#l00030">tensor.hpp:30</a></div></div>
<div class="ttc" id="ntf__utils_8hpp_html"><div class="ttname"><a href="../../d5/d2c/ntf__utils_8hpp.html">ntf_utils.hpp</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_a774d8786d47ebc8af750bbf283914f7e"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a774d8786d47ebc8af750bbf283914f7e">planc::DistAUNTF::compute_error</a></div><div class="ttdeci">void compute_error(bool i_error)</div><div class="ttdoc">Sets whether to compute the error or not. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00489">distauntf.hpp:489</a></div></div>
<div class="ttc" id="classplanc_1_1_n_t_f_m_p_i_communicator_html_a2ad9058522acfaaa1a8fbe40348fea0d"><div class="ttname"><a href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a2ad9058522acfaaa1a8fbe40348fea0d">planc::NTFMPICommunicator::rank</a></div><div class="ttdeci">int rank(const int *i_coords) const</div><div class="ttdoc">Returns the rank of current MPI process given the cartesian coordinates. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d9d/distntfmpicomm_8hpp_source.html#l00153">distntfmpicomm.hpp:153</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_aae089d72ce9a234054c9b760324c2e74"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#aae089d72ce9a234054c9b760324c2e74">planc::DistNTFTime::nnls_duration</a></div><div class="ttdeci">const double nnls_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00089">distntftime.hpp:89</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_a90b1672739e29d01a4d9ca63b276ed94"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a90b1672739e29d01a4d9ca63b276ed94">planc::DistNTFTime::gram_duration</a></div><div class="ttdeci">const double gram_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00085">distntftime.hpp:85</a></div></div>
<div class="ttc" id="distutils_8hpp_html_ab1187414c9a66ca31f476729c8fe4019"><div class="ttname"><a href="../../d9/de5/distutils_8hpp.html#ab1187414c9a66ca31f476729c8fe4019">startidx</a></div><div class="ttdeci">int startidx(int n, int p, int r)</div><div class="ttdoc">Returns the start idx of the current rank r for a global dimension n across p processes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de5/distutils_8hpp_source.html#l00090">distutils.hpp:90</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_a3cea39b5d73cc44fc9935c9d66800ee4"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a3cea39b5d73cc44fc9935c9d66800ee4">planc::DistNTFTime::duration</a></div><div class="ttdeci">const double duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00075">distntftime.hpp:75</a></div></div>
<div class="ttc" id="classplanc_1_1_n_c_p_factors_html_a4e062f586865ea4d312a8b8e523c9dd2"><div class="ttname"><a href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a4e062f586865ea4d312a8b8e523c9dd2">planc::NCPFactors::print</a></div><div class="ttdeci">void print()</div><div class="ttdoc">prints the entire NCPFactors including the factor matrices </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d12/ncpfactors_8hpp_source.html#l00307">ncpfactors.hpp:307</a></div></div>
<div class="ttc" id="classplanc_1_1_n_c_p_factors_html"><div class="ttname"><a href="../../d0/d20/classplanc_1_1_n_c_p_factors.html">planc::NCPFactors</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d12/ncpfactors_8hpp_source.html#l00022">ncpfactors.hpp:22</a></div></div>
<div class="ttc" id="classplanc_1_1_n_t_f_m_p_i_communicator_html_a823163aefe0200c91ef6c36e08276f47"><div class="ttname"><a href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a823163aefe0200c91ef6c36e08276f47">planc::NTFMPICommunicator::slice</a></div><div class="ttdeci">const MPI_Comm &amp; slice(const int i) const</div><div class="ttdoc">Returns the slice communicator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d9d/distntfmpicomm_8hpp_source.html#l00151">distntfmpicomm.hpp:151</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html">planc::DistAUNTF</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00032">distauntf.hpp:32</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_a21bbb0f1203ee0de54d14d98267b74f4"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21bbb0f1203ee0de54d14d98267b74f4">planc::DistNTFTime::mttkrp_duration</a></div><div class="ttdeci">const double mttkrp_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00087">distntftime.hpp:87</a></div></div>
<div class="ttc" id="class_dense_dimension_tree_html_aa8a9d63ae220a52ae0744995b2e3f463"><div class="ttname"><a href="../../da/d51/class_dense_dimension_tree.html#aa8a9d63ae220a52ae0744995b2e3f463">DenseDimensionTree::set_factor</a></div><div class="ttdeci">void set_factor(const double *arma_factor_ptr, const long int mode)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dca/ddt_8hpp_source.html#l00094">ddt.hpp:94</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_ac3fb680837e8f5ff49a0fb6294b75d85"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ac3fb680837e8f5ff49a0fb6294b75d85">planc::DistAUNTF::is_stale_mttkrp</a></div><div class="ttdeci">bool is_stale_mttkrp(const int &amp;current_mode) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00518">distauntf.hpp:518</a></div></div>
<div class="ttc" id="distutils_8h_html_a07b6ae6ec43cf3ac9859dddf771f0652"><div class="ttname"><a href="../../de/d18/distutils_8h.html#a07b6ae6ec43cf3ac9859dddf771f0652">MPITIC</a></div><div class="ttdeci">#define MPITIC</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d18/distutils_8h_source.html#l00026">distutils.h:26</a></div></div>
<div class="ttc" id="classplanc_1_1_n_c_p_factors_html_a78134126a1dfc0f8f9f39d96f4fd100d"><div class="ttname"><a href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a78134126a1dfc0f8f9f39d96f4fd100d">planc::NCPFactors::set_lambda</a></div><div class="ttdeci">void set_lambda(VEC new_lambda)</div><div class="ttdoc">sets the lambda vector </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d12/ncpfactors_8hpp_source.html#l00118">ncpfactors.hpp:118</a></div></div>
<div class="ttc" id="classplanc_1_1_n_c_p_factors_html_aff5902bc2267a2a5abaa6cac04cc9d8d"><div class="ttname"><a href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#aff5902bc2267a2a5abaa6cac04cc9d8d">planc::NCPFactors::trans</a></div><div class="ttdeci">void trans(NCPFactors &amp;factor_t)</div><div class="ttdoc">Transposes the entire factor matrix. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d12/ncpfactors_8hpp_source.html#l00328">ncpfactors.hpp:328</a></div></div>
<div class="ttc" id="utils_8h_html_a125109d4fd5ff9434c057b39668145d9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a125109d4fd5ff9434c057b39668145d9">FVEC</a></div><div class="ttdeci">#define FVEC</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00055">utils.h:55</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_ab29245138b70eba38b4630415f818af4"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ab29245138b70eba38b4630415f818af4">planc::DistNTFTime::allreduce_duration</a></div><div class="ttdeci">const double allreduce_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00081">distntftime.hpp:81</a></div></div>
<div class="ttc" id="distutils_8h_html_ad30c42027679247ceefdd77ac501a65a"><div class="ttname"><a href="../../de/d18/distutils_8h.html#ad30c42027679247ceefdd77ac501a65a">MPITOC</a></div><div class="ttdeci">#define MPITOC</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d18/distutils_8h_source.html#l00027">distutils.h:27</a></div></div>
<div class="ttc" id="utils_8h_html_abf52f4e0a107916756992adabfed2712"><div class="ttname"><a href="../../d5/d60/utils_8h.html#abf52f4e0a107916756992adabfed2712">algotype</a></div><div class="ttdeci">algotype</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00010">utils.h:10</a></div></div>
<div class="ttc" id="classplanc_1_1_tensor_html_a1079b99ea562b5d68303eefcffd4d561"><div class="ttname"><a href="../../d9/d5b/classplanc_1_1_tensor.html#a1079b99ea562b5d68303eefcffd4d561">planc::Tensor::mttkrp</a></div><div class="ttdeci">void mttkrp(const int i_n, const MAT &amp;i_krp, MAT *o_mttkrp) const</div><div class="ttdoc">size of krp must be product of all dimensions leaving out nxk. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8b/tensor_8hpp_source.html#l00245">tensor.hpp:245</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_af9e34f20ee83b11dd197606069ea9438"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#af9e34f20ee83b11dd197606069ea9438">planc::DistAUNTF::reset</a></div><div class="ttdeci">void reset(const NCPFactors &amp;new_factors, bool trans=false)</div><div class="ttdoc">This function will completely reset all the factors and the state of AUNTF. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00529">distauntf.hpp:529</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_ae3ffb151ee3735ae23092e456ac0a15a"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ae3ffb151ee3735ae23092e456ac0a15a">planc::DistAUNTF::num_iterations</a></div><div class="ttdeci">void num_iterations(const int i_n)</div><div class="ttdoc">Returns number of iterations. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00481">distauntf.hpp:481</a></div></div>
<div class="ttc" id="utils_8h_html_af4074c8410f817fe75e7ffa0a2abe69c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#af4074c8410f817fe75e7ffa0a2abe69c">UVEC</a></div><div class="ttdeci">#define UVEC</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00058">utils.h:58</a></div></div>
<div class="ttc" id="distauntf_8hpp_html_a5f5886b6ffbf74dc38dc950d531c5375"><div class="ttname"><a href="../../d2/d6a/distauntf_8hpp.html#a5f5886b6ffbf74dc38dc950d531c5375">TENSOR_LOCAL_DIM</a></div><div class="ttdeci">#define TENSOR_LOCAL_DIM</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00029">distauntf.hpp:29</a></div></div>
<div class="ttc" id="distutils_8h_html_a1b1045d80fa781ea9d7545890fdb8475"><div class="ttname"><a href="../../de/d18/distutils_8h.html#a1b1045d80fa781ea9d7545890fdb8475">DISTPRINTINFO</a></div><div class="ttdeci">#define DISTPRINTINFO(MSG)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d18/distutils_8h_source.html#l00037">distutils.h:37</a></div></div>
<div class="ttc" id="distutils_8hpp_html_a1381577b342f890deafff510d50c1050"><div class="ttname"><a href="../../d9/de5/distutils_8hpp.html#a1381577b342f890deafff510d50c1050">itersplit</a></div><div class="ttdeci">int itersplit(int n, int p, int r)</div><div class="ttdoc">The dimension a particular rank holds out of the global dimension n across p processes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de5/distutils_8hpp_source.html#l00078">distutils.hpp:78</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_ab06f56f6cbd7f49d838ce98fae2a5be0"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ab06f56f6cbd7f49d838ce98fae2a5be0">planc::DistNTFTime::multittv_duration</a></div><div class="ttdeci">const double multittv_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00088">distntftime.hpp:88</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_a12315f529ca569f9bbd3d812379816c2"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a12315f529ca569f9bbd3d812379816c2">planc::DistNTFTime::reducescatter_duration</a></div><div class="ttdeci">const double reducescatter_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00082">distntftime.hpp:82</a></div></div>
<div class="ttc" id="classplanc_1_1_n_c_p_factors_html_a9359f1890a4ffa2e7caeecf9667cffe1"><div class="ttname"><a href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a9359f1890a4ffa2e7caeecf9667cffe1">planc::NCPFactors::lambda</a></div><div class="ttdeci">VEC lambda() const</div><div class="ttdoc">returns the lambda vector </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d12/ncpfactors_8hpp_source.html#l00105">ncpfactors.hpp:105</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_a21b4ea48b952b204ad7ffe0ddd23e8c2"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a21b4ea48b952b204ad7ffe0ddd23e8c2">planc::DistNTFTime::compute_duration</a></div><div class="ttdeci">const double compute_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00076">distntftime.hpp:76</a></div></div>
<div class="ttc" id="distntfmpicomm_8hpp_html"><div class="ttname"><a href="../../d6/d9d/distntfmpicomm_8hpp.html">distntfmpicomm.hpp</a></div></div>
<div class="ttc" id="class_dense_dimension_tree_html_a60fbfff326baffbed48aaab575049417"><div class="ttname"><a href="../../da/d51/class_dense_dimension_tree.html#a60fbfff326baffbed48aaab575049417">DenseDimensionTree::in_order_reuse_MTTKRP</a></div><div class="ttdeci">void in_order_reuse_MTTKRP(long int n, double *out, bool colmajor, double &amp;multittv_time, double &amp;mttkrp_time)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dca/ddt_8hpp_source.html#l00135">ddt.hpp:135</a></div></div>
<div class="ttc" id="classplanc_1_1_n_t_f_m_p_i_communicator_html_a0510fe0fc47a3d3a2ae0a6a8733e42c4"><div class="ttname"><a href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a0510fe0fc47a3d3a2ae0a6a8733e42c4">planc::NTFMPICommunicator::proc_grids</a></div><div class="ttdeci">UVEC proc_grids() const</div><div class="ttdoc">Returns the process grid for which the communicators are setup. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d9d/distntfmpicomm_8hpp_source.html#l00170">distntfmpicomm.hpp:170</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_a3882110157f46bacf3546aa9f715e008"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a3882110157f46bacf3546aa9f715e008">planc::DistAUNTF::computeNTF</a></div><div class="ttdeci">void computeNTF()</div><div class="ttdoc">The main computeNTF loop. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00574">distauntf.hpp:574</a></div></div>
<div class="ttc" id="distutils_8hpp_html"><div class="ttname"><a href="../../d9/de5/distutils_8hpp.html">distutils.hpp</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_a46afca90f66d7b9e5b4b9f2728aae40a"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a46afca90f66d7b9e5b4b9f2728aae40a">planc::DistNTFTime::allgather_duration</a></div><div class="ttdeci">const double allgather_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00080">distntftime.hpp:80</a></div></div>
<div class="ttc" id="classplanc_1_1_n_t_f_m_p_i_communicator_html"><div class="ttname"><a href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html">planc::NTFMPICommunicator</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d9d/distntfmpicomm_8hpp_source.html#l00013">distntfmpicomm.hpp:13</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_ae7d14dd72b08811d9db6b6085a63976e"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ae7d14dd72b08811d9db6b6085a63976e">planc::DistAUNTF::regularizers</a></div><div class="ttdeci">void regularizers(const FVEC i_regs)</div><div class="ttdoc">L1 and L2 Regularization for every mode. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00487">distauntf.hpp:487</a></div></div>
<div class="ttc" id="classplanc_1_1_n_c_p_factors_html_ad817faad2c76a335bc9904187f08394a"><div class="ttname"><a href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#ad817faad2c76a335bc9904187f08394a">planc::NCPFactors::set</a></div><div class="ttdeci">void set(const int i_n, const MAT &amp;i_factor)</div><div class="ttdoc">Set the mode i_n with the given factor matrix. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d12/ncpfactors_8hpp_source.html#l00113">ncpfactors.hpp:113</a></div></div>
<div class="ttc" id="ddt_8hpp_html"><div class="ttname"><a href="../../d3/dca/ddt_8hpp.html">ddt.hpp</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_a4484bf5705eae381d5f5a2d549c5f073"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a4484bf5705eae381d5f5a2d549c5f073">planc::DistAUNTF::current_it</a></div><div class="ttdeci">int current_it() const</div><div class="ttdoc">Returns the current outer iteration of the computeNTF. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00497">distauntf.hpp:497</a></div></div>
<div class="ttc" id="distutils_8h_html_a509df87f9aaf440f1c0c42933d21e52a"><div class="ttname"><a href="../../de/d18/distutils_8h.html#a509df87f9aaf440f1c0c42933d21e52a">MPI_RANK</a></div><div class="ttdeci">#define MPI_RANK</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d18/distutils_8h_source.html#l00016">distutils.h:16</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_acc07c4b57bc37fa734ef2b5206a2d3b9"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#acc07c4b57bc37fa734ef2b5206a2d3b9">planc::DistAUNTF::current_error</a></div><div class="ttdeci">double current_error() const</div><div class="ttdoc">Returns the current error. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00499">distauntf.hpp:499</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_a36381a0100f64acc673ad6edde7a9822"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a36381a0100f64acc673ad6edde7a9822">planc::DistNTFTime::krp_duration</a></div><div class="ttdeci">const double krp_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00086">distntftime.hpp:86</a></div></div>
<div class="ttc" id="classplanc_1_1_n_t_f_m_p_i_communicator_html_a98879091cd81b026c13d15ace1753797"><div class="ttname"><a href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a98879091cd81b026c13d15ace1753797">planc::NTFMPICommunicator::fiber</a></div><div class="ttdeci">const MPI_Comm &amp; fiber(const int i) const</div><div class="ttdoc">Returns the fiber communicator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d9d/distntfmpicomm_8hpp_source.html#l00149">distntfmpicomm.hpp:149</a></div></div>
<div class="ttc" id="utils_8h_html_a0428171499a4ab7aebc2bf058ae337df"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a0428171499a4ab7aebc2bf058ae337df">UWORD</a></div><div class="ttdeci">#define UWORD</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00059">utils.h:59</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_ac47ee3e921fcc49c1df3e71a210bfbc3"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ac47ee3e921fcc49c1df3e71a210bfbc3">planc::DistNTFTime::trans_duration</a></div><div class="ttdeci">const double trans_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00094">distntftime.hpp:94</a></div></div>
<div class="ttc" id="classplanc_1_1_n_t_f_m_p_i_communicator_html_aa692d8359c7556e68515a055e1609a5a"><div class="ttname"><a href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#aa692d8359c7556e68515a055e1609a5a">planc::NTFMPICommunicator::fiber_rank</a></div><div class="ttdeci">int fiber_rank(int i) const</div><div class="ttdoc">Returns the fiber rank on a particular fiber grid. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d9d/distntfmpicomm_8hpp_source.html#l00166">distntfmpicomm.hpp:166</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_a664ac0ec775a16781965ed66473e8c7b"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a664ac0ec775a16781965ed66473e8c7b">planc::DistAUNTF::DistAUNTF</a></div><div class="ttdeci">DistAUNTF(const Tensor &amp;i_tensor, const int i_k, algotype i_algo, const UVEC &amp;i_global_dims, const UVEC &amp;i_local_dims, const UVEC &amp;i_nls_sizes, const UVEC &amp;i_nls_idxs, const NTFMPICommunicator &amp;i_mpicomm)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00432">distauntf.hpp:432</a></div></div>
<div class="ttc" id="utils_8h_html_a0653389baf2d065f3b297d8189292573"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a0653389baf2d065f3b297d8189292573">MAT</a></div><div class="ttdeci">#define MAT</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00052">utils.h:52</a></div></div>
<div class="ttc" id="classplanc_1_1_tensor_html_a9eadbed3e2a4cb987d5a3c91f7c14122"><div class="ttname"><a href="../../d9/d5b/classplanc_1_1_tensor.html#a9eadbed3e2a4cb987d5a3c91f7c14122">planc::Tensor::dimensions</a></div><div class="ttdeci">UVEC dimensions() const</div><div class="ttdoc">Returns a vector of dimensions on every mode. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8b/tensor_8hpp_source.html#l00164">tensor.hpp:164</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_a6115b102335dae49c1f025a869194981"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#a6115b102335dae49c1f025a869194981">planc::DistNTFTime::err_compute_duration</a></div><div class="ttdeci">const double err_compute_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00090">distntftime.hpp:90</a></div></div>
<div class="ttc" id="classplanc_1_1_n_t_f_m_p_i_communicator_html_a1b04ea8d23e01aa3cde5c540de574b25"><div class="ttname"><a href="../../d6/dc1/classplanc_1_1_n_t_f_m_p_i_communicator.html#a1b04ea8d23e01aa3cde5c540de574b25">planc::NTFMPICommunicator::slice_rank</a></div><div class="ttdeci">int slice_rank(int i) const</div><div class="ttdoc">Returns the slice rank on a particular slice grid. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d9d/distntfmpicomm_8hpp_source.html#l00168">distntfmpicomm.hpp:168</a></div></div>
<div class="ttc" id="classplanc_1_1_tensor_html_a3af9a550ddb640cc12edf60c57d10db7"><div class="ttname"><a href="../../d9/d5b/classplanc_1_1_tensor.html#a3af9a550ddb640cc12edf60c57d10db7">planc::Tensor::norm</a></div><div class="ttdeci">double norm() const</div><div class="ttdoc">returns the frobenius norm of the tensor </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8b/tensor_8hpp_source.html#l00349">tensor.hpp:349</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_a0a93f315ef938644f636995bda8edd65"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a0a93f315ef938644f636995bda8edd65">planc::DistAUNTF::modes</a></div><div class="ttdeci">size_t modes() const</div><div class="ttdoc">Returns the numbers of modes of the tensor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00483">distauntf.hpp:483</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html">planc::DistNTFTime</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00007">distntftime.hpp:7</a></div></div>
<div class="ttc" id="utils_8h_html_a65b44e666e1dbe8bd854bde3e58b1a5d"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a65b44e666e1dbe8bd854bde3e58b1a5d">ROWVEC</a></div><div class="ttdeci">#define ROWVEC</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00054">utils.h:54</a></div></div>
<div class="ttc" id="namespaceplanc_html"><div class="ttname"><a href="../../da/d9d/namespaceplanc.html">planc</a></div><div class="ttdoc">ncp_factors contains the factors of the ncp every ith factor is of size n_i * k number of factors is ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d12/ncpfactors_8hpp_source.html#l00020">ncpfactors.hpp:20</a></div></div>
<div class="ttc" id="distutils_8h_html_ac0fb59b02f5b7697ffdc417c8d7d16ea"><div class="ttname"><a href="../../de/d18/distutils_8h.html#ac0fb59b02f5b7697ffdc417c8d7d16ea">PRINTROOT</a></div><div class="ttdeci">#define PRINTROOT(MSG)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d18/distutils_8h_source.html#l00032">distutils.h:32</a></div></div>
<div class="ttc" id="utils_8h_html_a4749c5f07d5b90ecf9f3d53002f45b0b"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a4749c5f07d5b90ecf9f3d53002f45b0b">VEC</a></div><div class="ttdeci">#define VEC</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00060">utils.h:60</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_n_t_f_time_html_ad1d4997c821db265583e2849227a4098"><div class="ttname"><a href="../../d4/d31/classplanc_1_1_dist_n_t_f_time.html#ad1d4997c821db265583e2849227a4098">planc::DistNTFTime::communication_duration</a></div><div class="ttdeci">const double communication_duration() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc8/distntftime_8hpp_source.html#l00077">distntftime.hpp:77</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_a5e8e08d197922ae08b7278c0638a54b8"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a5e8e08d197922ae08b7278c0638a54b8">planc::DistAUNTF::factor</a></div><div class="ttdeci">void factor(int mode, double *factor_matrix)</div><div class="ttdoc">Returns the factor matrix by collected it across all the processors. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00552">distauntf.hpp:552</a></div></div>
<div class="ttc" id="classplanc_1_1_n_c_p_factors_html_a6e965facce66296cd9c0e581ab3d22af"><div class="ttname"><a href="../../d0/d20/classplanc_1_1_n_c_p_factors.html#a6e965facce66296cd9c0e581ab3d22af">planc::NCPFactors::factor</a></div><div class="ttdeci">MAT &amp; factor(const int i_n) const</div><div class="ttdoc">factor matrix of a mode i_n </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d12/ncpfactors_8hpp_source.html#l00101">ncpfactors.hpp:101</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_ad1a374db565c4b6af36029b8516fe305"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#ad1a374db565c4b6af36029b8516fe305">planc::DistAUNTF::~DistAUNTF</a></div><div class="ttdeci">~DistAUNTF()</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00474">distauntf.hpp:474</a></div></div>
<div class="ttc" id="class_dense_dimension_tree_html"><div class="ttname"><a href="../../da/d51/class_dense_dimension_tree.html">DenseDimensionTree</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dca/ddt_8hpp_source.html#l00011">ddt.hpp:11</a></div></div>
<div class="ttc" id="distauntf_8hpp_html_ac57248c9d6f6d4e1a9a891a6db1c00f9"><div class="ttname"><a href="../../d2/d6a/distauntf_8hpp.html#ac57248c9d6f6d4e1a9a891a6db1c00f9">TENSOR_LOCAL_NUMEL</a></div><div class="ttdeci">#define TENSOR_LOCAL_NUMEL</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00030">distauntf.hpp:30</a></div></div>
<div class="ttc" id="distntftime_8hpp_html"><div class="ttname"><a href="../../d7/dc8/distntftime_8hpp.html">distntftime.hpp</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_aaff9d99376f4e0e1ae1be2de571dd415"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#aaff9d99376f4e0e1ae1be2de571dd415">planc::DistAUNTF::dim_tree</a></div><div class="ttdeci">void dim_tree(bool i_dim_tree)</div><div class="ttdoc">MTTKRP can be computed with or without dimension trees. Dimtree is default. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00501">distauntf.hpp:501</a></div></div>
<div class="ttc" id="distutils_8h_html_a854b965f7a7fa796d55b57d4b50d47df"><div class="ttname"><a href="../../de/d18/distutils_8h.html#a854b965f7a7fa796d55b57d4b50d47df">MPI_SIZE</a></div><div class="ttdeci">#define MPI_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d18/distutils_8h_source.html#l00015">distutils.h:15</a></div></div>
<div class="ttc" id="classplanc_1_1_dist_a_u_n_t_f_html_a7088f10e6f50e34897e1cbab37d85d0a"><div class="ttname"><a href="../../d5/da3/classplanc_1_1_dist_a_u_n_t_f.html#a7088f10e6f50e34897e1cbab37d85d0a">planc::DistAUNTF::lambda</a></div><div class="ttdeci">VEC lambda()</div><div class="ttdoc">Returns the lambda of the NCP factors. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d6a/distauntf_8hpp_source.html#l00495">distauntf.hpp:495</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Dec 18 2018 22:28:25 for planc by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
